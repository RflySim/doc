

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Swarm &mdash; RflySimDoc 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Vision-based Control Interface" href="VisualInterface.html" />
    <link rel="prev" title="2. Scenes" href="Scene.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> RflySimDoc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../0_Start/WhatIsRflysim.html">1. What is RflySim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_Start/GettingStarted.html">2. Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Modeling</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../1_Modeling/Modeling.html">1. Modeling</a></li>
</ul>
<p class="caption"><span class="caption-text">Experimental Process</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../2_Configuration/Introduction.html">1. Overall Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_Configuration/SoftwareInstallation.html">2. Software Package Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_Configuration/HardwareConfiguration.html">3. Hardware Platform Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">Experimental Platform Usage:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../3_Using/Introduction.html">1. Brief Introduction to Experimental Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_Using/ControllerDesignAndSimulationPlatform.html">2. Simulink-Based Controller Design and Simulation Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_Using/PSPToolbox.html">3. PSP Toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_Using/PixhawkHardwareSystem.html">4. Pixhawk Hardware System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_Using/HILSimulator.html">5. HIL Simulation Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_Using/Examples.html">6. Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Platform Advanced Functions:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="CopterSim.html">1. CopterSim</a></li>
<li class="toctree-l1"><a class="reference internal" href="Scene.html">2. Scenes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Swarm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#swarm-simulation">3.1. Swarm Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulation-mode-settings">3.2. Simulation Mode Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multi-computer-distributed-simulation">3.3. Multi-computer Distributed Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#swarm-control-in-simulink">3.4. Swarm Control in Simulink</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="VisualInterface.html">4. Vision-based Control Interface</a></li>
</ul>
<p class="caption"><span class="caption-text">下载和支持:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../7_DownloadAndSupport/DownloadAndSupport.html">1. 下载和支持</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">RflySimDoc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li><span class="section-number">3. </span>Swarm</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/4_Pro/Cluster.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="swarm">
<h1><span class="section-number">3. </span>Swarm<a class="headerlink" href="#swarm" title="Permalink to this headline">¶</a></h1>
<div class="section" id="swarm-simulation">
<h2><span class="section-number">3.1. </span>Swarm Simulation<a class="headerlink" href="#swarm-simulation" title="Permalink to this headline">¶</a></h2>
<p>CopterSim also supports swarm simulations. As shown in Fig.A.18, open multiple
CopterSim programs and set the ID value of each aircraft to the desired value. Each
CopterSim needs to connect to a Pixhawk autopilot, and then click the “Start Simulation”
button to start the HIL simulation separately. The 3D display programs (only
supports the vision developed by UE4) will automatically receive all vehicle data
from the local network and display them in the same 3D display software.</p>
<div class="figure align-center" id="id2">
<img alt="../_images/Quan-app1-FigA.18.jpg" src="../_images/Quan-app1-FigA.18.jpg" />
<p class="caption"><span class="caption-text">Fig. A.18 CopterSim swarm simulation</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The current distributed simulation architecture theoretically supports HIL simulation
for any number of vehicles. The limitation mainly depends on the following
factors: the number of computer USB interfaces (each Pixhawk will occupy a USB
port), the memory size of the computer (each CopterSim will occupy a certain amount
of memory space), the computer processor speed (need to ensure that each CopterSim
can run in real-time).</p>
<p>Currently, CopterSim supports two methods to start the swarm simulation:</p>
<p>(1). The first method is to open multiple CopterSims manually. Repeat to click the
CopterSim.exe file to open an expected number of CopterSim programs one by
one, each of them assigned with a unique ID automatically . Then, connect the
serial ports and click to start the simulation.</p>
<p>(2). The second method is to open an expected number of CopterSim programs
together through a “bat” script, with automatically completing software configuration
and serial port selection. Open the “CopterSimAutoStartScriptTemp.bat”
script with a text editor, and the following content will be observed.</p>
<ul class="simple">
<li><p>start CopterSim.exe 1 1 20100 0 0 1 0 235 0 0 4</p></li>
<li><p>start CopterSim.exe 1 2 20102 0 0 1 0 235 0.5 0 5</p></li>
<li><p>start CopterSim.exe 1 3 20104 0 0 1 0 235.5 0 0 6</p></li>
<li><p>start CopterSim.exe 1 4 20106 0 0 1 0 235.5 1 0 7</p></li>
</ul>
<p>The above code shows a Windows batch bat script that opens four CopterSim
programs at a time. As corresponding with Fig.A.19, the 0th number followed by
CopterSim.exe means “whether the simulation starts automatically”; the 1st to
9th numbers correspond to the options of the advanced functions in the CopterSim
UI shown in Fig.A.2c; the 10th number corresponds to the Pixhawk USB
serial port number.</p>
<div class="figure align-center" id="id3">
<img alt="../_images/Quan-app1-FigA.19.jpg" src="../_images/Quan-app1-FigA.19.jpg" />
<p class="caption"><span class="caption-text">Fig. A.19 Corresponding relation between CopterSim’s parameters and script’s numbers</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="simulation-mode-settings">
<h2><span class="section-number">3.2. </span>Simulation Mode Settings<a class="headerlink" href="#simulation-mode-settings" title="Permalink to this headline">¶</a></h2>
<p>In addition to HIL simulation, CopterSim also supports other simulation modes to
improve test efficiency. As shown in Fig.A.20, there are several types of simulation
modes supported by CopterSim.</p>
<p>(1). HIL simulations for different versions of PX4 firmware. Since different HIL data
interfaces are required for different PX4 firmware versions, the best matching
simulation mode needs to be selected for different PX4 firmware versions to
ensure correct and efficient HIL simulation.</p>
<p>(2). SIL simulation with Simulink. The swarm simulation speed is very slow if all
full dynamics models are running directly by Simulink. As a result, it is not
convenient to observe the simulation results in real-time. Therefore, readers can
convert the Simulink model into a DLL model file which can be imported to
CopterSim by the code generation method mentioned in the previous section.
Then, Simulink controller can exchange sensor data and control signals with
CopterSim programs through the UDP to form a closed-loop swarm SIL simulation
platform. In swarm simulations, the UDP port number in Fig.A.20 needs to
be different among CopterSim programs, and then Simulink can communicate
with each CopterSim program through the corresponding port number. It should
be noted that the DLL model source code presented in Fig.A.15 also supports
to simulate a complete closed-loop system with both model and controller. This
makes it possible to directly send the speed commands to DLL models, and
perform the SIL simulations to test the top-level decision-making algorithms.</p>
<blockquote>
<div><div class="figure align-center" id="id4">
<img alt="../_images/Quan-app1-FigA.20.jpg" src="../_images/Quan-app1-FigA.20.jpg" />
<p class="caption"><span class="caption-text">Fig. A.20 CopterSim simulation mode setting</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
</div></blockquote>
<p>(3). Connecting with the PX4 autopilot software (without Pixhawk hardware) to
perform SIL simulations on a computer. The PX4 source code also supports to
be compiled into a firmware that can be run in a computer. Run N PX4 autopilot
software on a computer, and then open N CopterSim programs to connect with
them correspondingly. Then, it is possible to perform swarm SIL simulations
with PX4 autopilot software on the same computer. Note that the PX4 software
defaults to use the TCP port 4560. <a class="footnote-reference brackets" href="#f1" id="id1">1</a> Readers can manually specify the port number
in the PX4 startup script to match with the CopterSim programs.</p>
</div>
<div class="section" id="multi-computer-distributed-simulation">
<h2><span class="section-number">3.3. </span>Multi-computer Distributed Simulation<a class="headerlink" href="#multi-computer-distributed-simulation" title="Permalink to this headline">¶</a></h2>
<p>As mentioned in the previous section, the computing performance and memory space
of a single computer are limited, so it is impossible to support swarm simulation for
an unlimited amount of vehicles. Therefore, CopterSim also provides the function to
perform distributed simulation through Local Area Network (LAN) by using multiple
computers. As shown in Fig.A.21, enable the “Link” option on the UI of CopterSim
to start the network broadcast function. The flight data of each CopterSim will
be received by all computers via the LAN. Therefore, with enough computers connecting
to the LAN, and a certain amount of CopterSim programs (in HIL or SIL
simulation modes) are run on each computer, the platform can realize swarm distributed
simulation for any number of vehicles. At the same time, each computer can
open multiple 3D scene programs to observe all vehicles from multiple perspectives.
Note that if the “Link” checkbox is unchecked, the flight information of CopterSim
can only be received by this computer, so it will not affect other computers, which
is more suitable for the use in experimental courses.</p>
<div class="figure align-center" id="id5">
<img alt="../_images/Quan-app1-FigA.21.jpg" src="../_images/Quan-app1-FigA.21.jpg" />
<p class="caption"><span class="caption-text">Fig. A.21 CopterSim distributed simulation architecture</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="swarm-control-in-simulink">
<h2><span class="section-number">3.4. </span>Swarm Control in Simulink<a class="headerlink" href="#swarm-control-in-simulink" title="Permalink to this headline">¶</a></h2>
<p>For swarm simulation, communication and real-time control is a difficult task. In
response to these needs, we have developed tutorials with source codes (see Fig.A.22)
based on the advanced functions of this experimental platform. The main implemented
features are shown in the following.</p>
<div class="figure align-center" id="id6">
<img alt="../_images/Quan-app1-FigA.22.jpg" src="../_images/Quan-app1-FigA.22.jpg" />
<p class="caption"><span class="caption-text">Fig. A.22 Source code for Simulink swarm control</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p>(1). Open-loop Swarm SIL simulation. The advanced platform can send swarm data
to the UE4 scene display software with the Simulink UDP interface to preview
the trajectories of all vehicles. With this function, on the one hand, it is convenient
to generate trajectories for static or moving obstacles, so complex swarm flight
scenes can be visualized as shown in Fig.A.23. On the other hand, it provides the
opportunity to preview the swarm flight performance, which helps developers to
improve the designed trajectories.</p>
<blockquote>
<div><div class="figure align-center" id="id7">
<img alt="../_images/Quan-app1-FigA.23.jpg" src="../_images/Quan-app1-FigA.23.jpg" />
<p class="caption"><span class="caption-text">Fig. A.23 Example for heterogeneous unmanned systems in UE4</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
</div></blockquote>
<p>(2). Closed-loop Swarm SIL simulation. The advanced platform provides a Simulink
UDP interface to exchange motion states and control signals from all CopterSim
SIL control models to realize the closed-loop swarm SIL simulation. The
CopterSim SIL control model can be 1) a DLL model file including both a multicopter
motion model and a velocity-loop controller; or 2) CopterSim motion
model controlled by a PX4 autopilot under the SIL simulation mode.</p>
<p>(3). Closed-loop Swarm HIL simulation. The advanced platform provides a Simulink
UDP interface to exchange motion states and control signals from all CopterSim
HIL control models to realize the swarm HIL simulation. The CopterSim HIL
control model is a closed-loop control system involving real Pixhawk autopilots.
CopterSim can automatically forward Mavlink message packets from the
Pixhawk autopilot serial port to Simulink. Furthermore, interfaces are also
developed to directly encode and decode Mavlink message in Simulink. As a result,
users can control each Pixhawk+CopterSim HIL system by Simulink.</p>
<p>(4). Closed-loop swarm flight by Simulink. The advanced platform provides the serial
communication interface to directly exchange data with each Pixhawk autopilot
via wireless radio telemetry, as well as UDP/ROS interfaces to communicate
with vehicles in the same WIFI network. Therefore, it is convenient to realize the
functions of GCSs to receive flight data from multiple vehicles in real-time and
send back control signals. Compared with GCS software developed by C/C++, it
is more convenient to tune the controller parameters on line and observe the realtime
control performance in Simulink. Besides, the Simulink swarm controller
can also be converted into C/C++ to improve the running speed.</p>
<p>Through the above procedure, developers can perform the development, simulations
and flight tests in a step-by-step process, which may significantly improve the development
efficiency for swarm control systems.</p>
<p class="rubric">Reference</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><a class="reference external" href="http://dev.px4.io/master/en/simulation/">http://dev.px4.io/master/en/simulation/</a></p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="VisualInterface.html" class="btn btn-neutral float-right" title="4. Vision-based Control Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Scene.html" class="btn btn-neutral float-left" title="2. Scenes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Rfly

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>