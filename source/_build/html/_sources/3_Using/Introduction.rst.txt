1. 实验平台总体介绍
============================

1.1 实验平台组成
------------------------

依托Rflysim平台，本实验平台是一个基于 MATLAB/Simulink 和Pixhawk 的多旋翼飞行器控制算法快速开发平台。它主要由以下五大部分组成：基于 Simulink 的控制器设计与仿真平台、硬件在环仿真平台、`Pixhawk 自驾仪系统 <https://docs.px4.io/master/en/flight_controller/pixhawk_series.html>`_ 、多旋翼硬件系统和实验指导包。

（1）基于 Simulink 的控制器设计与仿真平台

本平台包含了一个高逼真的多旋翼模型可以用来仿真多旋翼飞行器的各种动态特性，并用 FlightGear 图形化展示多旋翼飞行器实时飞行的轨迹与姿态等状态信息。在基于 Simulink 的平台上，读者可以方便地设计多旋翼飞行器的控制算法，然后进行软件在环仿真验证。进一步，可以通过 Pixhawk Support Package (PSP) 工具箱将控制算法生成 C/C++ 代码，然后将其编译并下载到真实的 Pixhawk 自驾仪中。

.. figure:: /images/3-1.jpg
    :align: center

    图 3.1 基于 Simulink 的控制器设计与仿真平台示意图

（2）硬件在环仿真平台

硬件在环仿真平台包括实时运动仿真软件——CopterSim （见下图 (a))和三维可视化视景软件——3DDisplay（见下图 (b))。CopterSim 的仿真模型是直接从 Simulink 仿真平台中导入的。CopterSim 和 3DDisplay 两个软件都需要运行在 Windows 平台（Win7 以上，64 位系统)的计算机上，然后通过 USB 数据线与 Pixhawk 自驾仪相连构成闭环控制系统，进行硬件在环仿真。

.. figure:: /images/3-2.jpg
    :align: center

    图 3.2 硬件在环仿真平台

（3）Pixhawk 自驾仪系统

Pixhawk 自驾仪系统包括 Pixhawk 自驾仪、遥控器、接收机和地面站。其中，本书推荐使用的 Pixhawk 自驾仪实际上由 `Pixhawk 1 <https://docs.px4.io/master/en/flight_controller/pixhawk.html>`_ 自驾仪硬件和 PX4 自驾仪软件组成。PX4 自驾仪软件内置的实时操作系统用来实现多线程分配、底层驱动和算法执行等功能。Pixhawk 自驾仪可以通过接收机与遥控器建立无线连接，从而接收地面操控者通过遥控器发出的操纵指令。此外，Pixhawk 自驾仪也可以通过数传模块与地面站相连，进行飞行数据和任务指令的实时通信。

.. figure:: /images/3-3.jpg
    :align: center

    图 3.3 Pixhawk 自驾仪系统

（4）多旋翼硬件系统

多旋翼硬件系统通常包括机架系统、动力系统、外部传感器和测试台架等。多旋翼硬件系统装上 Pixhawk 自驾仪组成了一个完整的多旋翼飞行平台，可以完成特定的飞行任务。根据实际的飞行性能需求，多旋翼机架系统可以设计成不同的布局，例如四旋翼、六旋翼、共轴八旋翼等。本例程以一个小型的四旋翼为例子，研究其硬件系统（如机架设计和动力系统选型等)的设计方法。然后，在得到的多旋翼硬件系统上完成自驾仪控制算法的开发。

.. figure:: /images/3-4.jpg
    :align: center

    图 3.4 多旋翼硬件系统

（5）实验指导包

包括视频教程、课件和例程源码等，主题紧扣《全权著. 多旋翼飞行器设计与控制[M]. 杜光勋, 赵峙尧, 戴训华, 等译. 北京: 电子工业出版社, 2017》 与`网上在线课程MOOC: <https://www.icourse163.org/course/BUAA-1205700805>`_ 。

1.2 实验平台优势
----------------------

本实验平台在MATLAB/Simulink 中提供了多旋翼控制器设计的相关接口，读者(初学者、学生或者工程师)可以利用自己所学知识快速进行控制器的设计与验证。在控制器设计完成后，本平台提供代码生成与下载功能，可以将设计的 Simulink 控制算法生成 C/C++ 代码，然后将其编译进入 PX4 自驾仪固件中，并自动下载到 Pixhawk 自驾仪中。本平台还提供硬件在环仿真测试功能，读者可以在真实 Pixhawk 自驾仪系统上对飞行效果进行初步模拟测试，排除实飞实验可能存在的各种问题。测试通过之后，将 Pixhawk 自驾仪装在一个多旋翼硬件系统上，就可以进行室内和室外的飞行实验，通过实验验证来评估设计控制算法的性能。